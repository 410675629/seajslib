/* 2013-04-11 */
define("calendar/1.0.0/calendar",[],function(t,e,n){function o(t,e,n,a,r,l){this.beginYear=t||1990,this.endYear=e||2020,this.language=n||0,this.patternDelimiter=a||"-",this.date2StringPattern=r||o.language.date2StringPattern[this.language].replace(/\-/g,this.patternDelimiter),l&&(l=l.toLowerCase()),this.string2DatePattern=l||o.language.string2DatePattern[this.language],this.dateControl=null,this.panel=$("#calendarPanel")[0],this.iframe=window.frames.calendarIframe,this.form=null,this.date=new Date,this.year=this.date.getFullYear(),this.month=this.date.getMonth(),this.colors={bg_cur_day:"#00CC33",bg_over:"#EFEFEF",bg_out:"#FFCC00"}}function a(){var t='<div id="calendarPanel" style="position:absolute;display:none;background-color:#FFFFFF;border:1px solid #666666;width:210px;height:216px;">';t+='<iframe name="calendarIframe" id="calendarIframe" width="100%" height="100%" scrolling="no" frameborder="0" style="margin:0px;"></iframe>',t+="</div>";var e=document.createElement("DIV");e.innerHTML=t,document.body.appendChild(e);var n=window.frames.calendarIframe;t='<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">',t+='<html xmlns="http://www.w3.org/1999/xhtml">',t+="<head>",t+='<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />',t+="<title>Web Calendar</title>",t+='<style type="text/css">',t+="body {font-size:12px;margin:0px;text-align:center;}",t+="form {margin:0px;}",t+="select {font-size:12px;background-color:#EFEFEF;}",t+="table {border:0px solid #CCCCCC;background-color:#FFFFFF}",t+="th {font-size:12px;font-weight:normal;background-color:#FFFFFF;}",t+="th.theader {font-weight:normal;background-color:#666666;color:#FFFFFF;width:24px;}",t+="select.year {width:66px;margin-right:2px;}",t+="select.month {width:62px;}",t+="td {font-size:12px;text-align:center;cursor:default;}",t+="td.sat {color:#0000FF;background-color:#EFEFEF;}",t+="td.sun {color:#FF0000;background-color:#EFEFEF;}",t+="td.normal {background-color:#EFEFEF;}",t+="input.l {border: 1px solid #CCCCCC;background-color:#EFEFEF;width:20px;height:20px;}",t+="input.r {border: 1px solid #CCCCCC;background-color:#EFEFEF;width:20px;height:20px;}",t+="input.b {border: 1px solid #CCCCCC;background-color:#EFEFEF;width:100%;height:20px;}",t+="</style>",t+="</head>",t+="<body>",t+="</body>",t+="</html>",n.document.write(t),n.document.close(),r=new o,"function"==typeof jQuery&&jQuery(document).click(function(t){$(t.target).is(":input")||$("#calendarPanel").hide()})}$(document).delegate("input[data-toggle=calendar]","click.calendar.data-api",function(t){var e=new Date,n=$(this).data(),a=n.beginyear||2e3,r=n.endyear||e.getFullYear();new o(a,r,0,"-","yyyy-MM-dd","ymd").show(t.target)}),o.language={year:["年","","","年","年"],months:[["一月","二月","三月","四月","五月","六月","七月","八月","九月","十月","十一月","十二月"],["JAN","FEB","MAR","APR","MAY","JUN","JUL","AUG","SEP","OCT","NOV","DEC"],["JAN","FEB","MAR","APR","MAY","JUN","JUL","AUG","SEP","OCT","NOV","DEC"],["一月","二月","三月","四月","五月","六月","七月","八月","九月","十月","十一月","十二月"],["一月","二月","三月","四月","五月","六月","七月","八月","九月","十月","十一月","十二月"]],weeks:[["日","一","二","三","四","五","六"],["Sun","Mon","Tur","Wed","Thu","Fri","Sat"],["Sun","Mon","Tur","Wed","Thu","Fri","Sat"],["日","一","二","三","四","五","六"],["日","月","火","水","木","金","土"]],clear:["清空","Clear","Clear","清空","削除"],today:["今天","Today","Today","今天","今日"],close:["关闭","Close","Close","關閉","戻る"],date2StringPattern:["yyyy-MM-dd","yyyy-MM-dd","yyyy-MM-dd","yyyy-MM-dd","yyyy-MM-dd"],string2DatePattern:["ymd","ymd","ymd","ymd","ymd"]},o.prototype.draw=function(){r=this;var t=[];t[t.length]='<form id="__calendarForm" name="__calendarForm" method="post">',t[t.length]='<table id="__calendarTable" width="100%" border="0" cellpadding="3" cellspacing="1" align="center">',t[t.length]=" <tr>",t[t.length]='  <th><input class="l" name="goPrevMonthButton" type="button" id="goPrevMonthButton" value="&lt;" /></th>',t[t.length]='  <th colspan="5"><select class="year" name="yearSelect" id="yearSelect"></select><select class="month" name="monthSelect" id="monthSelect"></select></th>',t[t.length]='  <th><input class="r" name="goNextMonthButton" type="button" id="goNextMonthButton" value="&gt;" /></th>',t[t.length]=" </tr>",t[t.length]=" <tr>";for(var e=0;7>e;e++)t[t.length]='<th class="theader">',t[t.length]=o.language.weeks[this.language][e],t[t.length]="</th>";t[t.length]="</tr>";for(var e=0;6>e;e++){t[t.length]='<tr align="center">';for(var n=0;7>n;n++)switch(n){case 0:t[t.length]='<td class="sun">&nbsp;</td>';break;case 6:t[t.length]='<td class="sat">&nbsp;</td>';break;default:t[t.length]='<td class="normal">&nbsp;</td>'}t[t.length]="</tr>"}t[t.length]=" <tr>",t[t.length]='  <th colspan="2"><input type="button" class="b" name="clearButton" id="clearButton" /></th>',t[t.length]='  <th colspan="3"><input type="button" class="b" name="selectTodayButton" id="selectTodayButton" /></th>',t[t.length]='  <th colspan="2"><input type="button" class="b" name="closeButton" id="closeButton" /></th>',t[t.length]=" </tr>",t[t.length]="</table>",t[t.length]="</form>",this.iframe.document.body.innerHTML=t.join(""),this.form=this.iframe.document.forms.__calendarForm,this.form.clearButton.value=o.language.clear[this.language],this.form.selectTodayButton.value=o.language.today[this.language],this.form.closeButton.value=o.language.close[this.language],this.form.goPrevMonthButton.onclick=function(){r.goPrevMonth(this)},this.form.goNextMonthButton.onclick=function(){r.goNextMonth(this)},this.form.yearSelect.onchange=function(){r.update(this)},this.form.monthSelect.onchange=function(){r.update(this)},this.form.clearButton.onclick=function(){r.dateControl.value="",r.hide()},this.form.closeButton.onclick=function(){r.hide()},this.form.selectTodayButton.onclick=function(){var t=new Date;r.date=t,r.year=t.getFullYear(),r.month=t.getMonth(),r.dateControl.value=t.format(r.date2StringPattern),r.hide()}},o.prototype.bindYear=function(){var t=this.form.yearSelect;t.length=0;for(var e=this.beginYear;this.endYear>=e;e++)t.options[t.length]=new Option(e+o.language.year[this.language],e)},o.prototype.bindMonth=function(){var t=this.form.monthSelect;t.length=0;for(var e=0;12>e;e++)t.options[t.length]=new Option(o.language.months[this.language][e],e)},o.prototype.goPrevMonth=function(){(this.year!=this.beginYear||0!=this.month)&&(this.month--,-1==this.month&&(this.year--,this.month=11),this.date=new Date(this.year,this.month,1),this.changeSelect(),this.bindData())},o.prototype.goNextMonth=function(){(this.year!=this.endYear||11!=this.month)&&(this.month++,12==this.month&&(this.year++,this.month=0),this.date=new Date(this.year,this.month,1),this.changeSelect(),this.bindData())},o.prototype.changeSelect=function(){for(var t=this.form.yearSelect,e=this.form.monthSelect,n=0;t.length>n;n++)if(t.options[n].value==this.date.getFullYear()){t[n].selected=!0;break}for(var n=0;e.length>n;n++)if(e.options[n].value==this.date.getMonth()){e[n].selected=!0;break}},o.prototype.update=function(t){this.year=t.form.yearSelect.options[t.form.yearSelect.selectedIndex].value,this.month=t.form.monthSelect.options[t.form.monthSelect.selectedIndex].value,this.date=new Date(this.year,this.month,1),this.changeSelect(),this.bindData()},o.prototype.bindData=function(){for(var t=this,e=this.getMonthViewDateArray(this.date.getFullYear(),this.date.getMonth()),n=this.getElementsByTagName("td",this.getElementById("__calendarTable",this.iframe.document)),o=0;n.length>o;o++)if(n[o].style.backgroundColor=t.colors.bg_over,n[o].onclick=null,n[o].onmouseover=null,n[o].onmouseout=null,n[o].innerHTML=e[o]||"&nbsp;",!(o>e.length-1)&&e[o]){n[o].onclick=function(){t.dateControl&&(t.dateControl.value=new Date(t.date.getFullYear(),t.date.getMonth(),this.innerHTML).format(t.date2StringPattern)),t.hide()},n[o].onmouseover=function(){this.style.backgroundColor=t.colors.bg_out},n[o].onmouseout=function(){this.style.backgroundColor=t.colors.bg_over};var a=new Date;a.getFullYear()==t.date.getFullYear()&&a.getMonth()==t.date.getMonth()&&a.getDate()==e[o]&&(n[o].style.backgroundColor=t.colors.bg_cur_day,n[o].onmouseover=function(){this.style.backgroundColor=t.colors.bg_out},n[o].onmouseout=function(){this.style.backgroundColor=t.colors.bg_cur_day})}},o.prototype.getMonthViewDateArray=function(t,e){for(var n=Array(42),o=new Date(t,e,1).getDay(),a=new Date(t,e+1,0).getDate(),r=0;a>r;r++)n[r+o]=r+1;return n},o.prototype.show=function(t,e){if("block"==this.panel.style.display&&(this.panel.style.display="none"),!t)throw Error("arguments[0] is necessary!");this.dateControl=t,e=e||t,this.draw(),this.bindYear(),this.bindMonth(),t.value.length>0&&(this.date=new Date(t.value.toDate(this.patternDelimiter,this.string2DatePattern)),this.year=this.date.getFullYear(),this.month=this.date.getMonth()),this.changeSelect(),this.bindData();var n=this.getAbsPoint(e);this.panel.style.left=n.x+"px",this.panel.style.top=n.y+t.offsetHeight+"px",this.panel.style.display="block"},o.prototype.hide=function(){this.panel.style.display="none"},o.prototype.getElementById=function(t,e){return e=e||document,document.getElementById?e.getElementById(t):document.all(t)},o.prototype.getElementsByTagName=function(t,e){return e=e||document,document.getElementsByTagName?e.getElementsByTagName(t):document.all.tags(t)},o.prototype.getAbsPoint=function(t){for(var e=t.offsetLeft,n=t.offsetTop;t=t.offsetParent;)e+=t.offsetLeft,n+=t.offsetTop;return{x:e,y:n}},Date.prototype.format=function(t){var e={"M+":this.getMonth()+1,"d+":this.getDate(),"h+":this.getHours(),"m+":this.getMinutes(),"s+":this.getSeconds(),"w+":"日一二三四五六".charAt(this.getDay()),"q+":Math.floor((this.getMonth()+3)/3),S:this.getMilliseconds()};/(y+)/.test(t)&&(t=t.replace(RegExp.$1,(this.getFullYear()+"").substr(4-RegExp.$1.length)));for(var n in e)RegExp("("+n+")").test(t)&&(t=t.replace(RegExp.$1,1==RegExp.$1.length?e[n]:("00"+e[n]).substr((""+e[n]).length)));return t},String.prototype.toDate=function(t,e){t=t||"-",e=e||"ymd";var n=this.split(t),o=parseInt(n[e.indexOf("y")],10);2>=(""+o).length&&(o+=2e3),isNaN(o)&&(o=(new Date).getFullYear());var a=parseInt(n[e.indexOf("m")],10)-1,r=parseInt(n[e.indexOf("d")],10);return isNaN(r)&&(r=1),new Date(o,a,r)};var r;document.body?a():setTimeout(a,0),n.exports=o});