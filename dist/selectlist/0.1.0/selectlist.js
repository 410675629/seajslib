/* 2013-04-11 */
(function(e){function t(t,n,a){var l={select_text:"",load_all:!0,selected_id:0,load_callback:function(){}};this.tmp_data={},this.data_map={},this.box=e(t),this.config="object"==typeof a?e.extend(l,a):l,this.select_obj=null,this.init(n)}define("selectlist/0.1.0/selectlist",[],function(){}),e.fn.selectList=function(e,n){var a=this;return new t(a[0],e,n),a};var n=t.prototype;n.init=function(e){var t=this,n=t.tmp_data,a=null,l=t.config,i=0,c=null;if(e instanceof Array&&e.length&&t.box.length){for(var o=0;e.length>o;o++)a=e[o],i=a.parent_id?a.parent_id:i,l.selected_id==a.id&&(t.select_obj=a),t.data_map[a.id]=a,n[a.parent_id]instanceof Array?n[a.parent_id].push(a):l.select_text.length?(n[a.parent_id]=[{id:"",name:l.select_text}],n[a.parent_id].push(a)):n[a.parent_id]=[a];c=t.load_select(0),t.select_obj?t.set_select():l.load_all&&c.length&&c.trigger("change"),"function"==typeof l.load_callback&&l.load_callback()}},n.load_select=function(t){var n=this,a=n.tmp_data,l=a[t],i=n.box,c=[],o=null,r=(n.config,i.find("select[parent_id="+t+"]"));if(!(l instanceof Array&&l.length))return r;for(var s=0;l.length>s;s++)o=l[s],c.push('<option value="'+o.id+'">'+o.name+"</option>");return r.length?r.html(c.join("")):(r=e('<select parent_id="'+t+'">'+c.join("")+"</select>"),i.append(r),r.change(function(){n.change(e(this))})),r},n.change=function(e){var t=this,n=e.attr("parent_id"),a=e.val(),l=(t.box,null),i=t.config;t.clear_next(n),a.length&&(l=t.load_select(a),i.load_all&&l.length&&l.trigger("change"))},n.set_select=function(e){var t=this,n=t.data_map,a=e?n[e]:t.select_obj,l=[],i=null,c=t.box;for(c.find("select[parent_id]").remove();a;)l.push(a),a=n[a.parent_id];for(;l.length;)a=l.pop(),i=t.load_select(a.parent_id),i.val(a.id),0==l.length&&i.trigger("change")},n.clear_next=function(e){var t=this,n=t.box,a=n.find("select[parent_id="+e+"]");if(a.length)for(;a.next("select[parent_id]").length;)a.next("select[parent_id]").remove()}})(jQuery);