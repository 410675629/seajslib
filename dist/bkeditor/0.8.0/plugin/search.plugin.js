/*! Bkeditor - v0.8.0 - 2013-05-24
* https://github.com/daixianfeng/a
* Copyright (c) 2013 daixianfeng; Licensed MIT */
(function(e,t){e.addUi({id:"searchdialog",search:function(n){var i="prev"===n?!1:!0,r=t("#searchdialog");if(0!==r.size()){var o=r.find("#sourceword").val(),a=r.find("[name=whole]")[0].checked,l=r.find("[name=sensitive]")[0].checked;return e.utils.execPlugin("search","search",{backward:i,sourceword:o,whole:a,sensitive:l}),!1}return!1},replace:function(){var n=t("#searchdialog");if(0!==n.size()){var i=n.find("#sourceword").val(),r=n.find("#targetword").val(),o=n.find("[name=whole]")[0].checked,a=n.find("[name=sensitive]")[0].checked;return e.utils.execPlugin("search","replace",{backward:!0,sourceword:i,targetword:r,whole:o,sensitive:a}),!1}return!1}})})(window.jQuery.jQEditor,window.jQuery),function(e){e.dialogHtml.searchdialog='<TABLE ui="searchdialog"><TR><TD>查找：</TD><TD><input type="text" id="sourceword" name="sourceword" /></TD></TR><TR><TD>替换：</TD><TD><input type="text" id="targetword" name="targetword"/></TD></TR><TR><TD><input type="checkbox" id="whole" name="whole"/>全词匹配</TD><TD>&nbsp;</TD></TR><TR><TD><input type="checkbox" id="sensitive" name="sensitive"/>大小写相关</TD><TD>&nbsp;</TD></TR></TABLE>'}(window.jQuery.jQEditor),function(e){e.addPlugin({id:"search",type:"dialog",showDialog:function(t){e.utils.loadDialog(this.id,e.config.cUi.addr+"search/",function(){var n=t.Eid;e.dialog.open({id:"searchdialog",editor:n,title:"查找",content:$("[ui=searchdialog]"),button:[{name:"<< 查找",callback:function(){return e.command("searchdialog","search","prev"),!1}},{name:"查找 >>",callback:function(){return e.command("searchdialog","search","next"),!1}},{name:"替换 ≒",callback:function(){return e.command("searchdialog","replace"),!1}}],icon:"succeed"})})},search:function(t){var n=e.editWin,i=!1;if(e.IE){var r=n.document.body.createTextRange();n.focus();var o=n.document.selection.createRange().duplicate();try{t.backward?r.setEndPoint("StartToEnd",o):r.setEndPoint("EndToStart",o)}catch(a){n.focus()}var l=t.sourceword,s=t.whole===!0?2:0,c=t.sensitive===!0?4:0,d=t.backward===!0?0:-1,u=s|c;i=r.findText(l,d,u),i&&r.select()}else{var l=t.sourceword,f=t.whole,m=t.sensitive,p=t.backward===!0?!1:!0;i=n.find(l,m,p,!1,f)}i||e.errorMessage("没有找到目标！")},replace:function(t){e.editWin;var n=e.utils.getSelectionText();n.toLowerCase()!==t.sourceword.toLowerCase()?this.search(t):(e.utils.replaceSelectedText(e.editWin,t.targetword),this.search(t))}})}(window.jQuery.jQEditor);